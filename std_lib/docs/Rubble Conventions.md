
Rubble Conventions
========================================================================================================================

This file consists of a style guide and list of advice for the best ways to structure your addons and name your files.

Much of this advice is my own, but some of it comes from other Rubble modders. Everything here is the result of
experience, ignore at your peril!

Read [Rubble Basics](/doc/Rubble%20Basics.md) before reading this document! I do not tell you how to do things here,
just what to do (if that makes any sense).

The advice contained in this file tends to slowly change over time as Rubble gains new features or better ways to do
things are decided upon.


Addons:
------------------------------------------------------------------------------------------------------------------------

When naming your addons you should choose something nice and clear. Your addon name should be something unique, but don't
include any "tags", a version number, an author name, etc since the addon name is displayed to the user as-is. Version
and author should be put in the proper fields in your addon.meta file anyway. By convention addon names should be written
in Title Case, don't forget that "the" and "of" should not be capitalized unless they are the first word of the title!

In addition to your addon name you should pick a "mod ID" for your addon or addon pack. This ID should be a short (2-5
character) acronym or abbreviation that is used to uniquely identify your mod or mod pack. Small addons (those with only
3-4 files) can probably share an ID, but this ID should be unique to you. Rubble does not care about the ID, it is
intended to be used to identify files and templates belonging to the addon or addon pack, mostly as a way to prevent name
collisions.

Like addons should be grouped, if your addon contains optional extras make them children of a main "core" addon that
contains the basic functionality of your mod. Your "core" addon should have a static addon name defined in it's
addon.meta file. This will allow users to install your addon in non-standard ways without breaking anything.

Your core (or only) addon should have the `Author` and `Version` fields set in it's addon.meta file, as well as any other
fields that it makes sense to set. If your addon has configuration variables make sure you set their "display names".
Finally (and most importantly) you should set the `Header` field with a single line description of the addon.

If you intend to distribute your addon to the public it is best to pack it in a zip file, with the files of your core
addon contained in the root of the zip file. Generally you should not include the version number in the name of your zip
file, as including the version number either prevents you from using the auto-update feature or makes it nonsensical (you
end up with the actual version not matching the version number in the name).

Speaking of version numbers: Make sure you set the addon pack version fields in your pack.meta file properly! If these
fields are not set (or worse, set improperly), auto-update may not work properly or at all.

You should always use DFFD for addon uploads, as most other file hosting sites do not support the direct downloads needed
for the automatic update system to work.

If you include a pack.meta file in your addon pack do not set the "Name" field unless the pack will be listed on a content
server. Setting a canonical name for your pack will make it so that Rubble will refuse to load if the pack is installed
under any other name (this is intended to prevent multiple copies from being loaded inadvertently).


Addon Descriptions
------------------------------------------------------------------------------------------------------------------------

Your addon documentation/readme should be contained in a separate file that is then listed in the addon.meta file via
the `DescFile` key. It is best to format these files in markdown, with HTML also being a good choice (plain text is a
distant third). If you use a HTML file for your addon description keep in mind that it will be injected into the body
of a larger HTML document generated by Rubble, for this reason do not include `head` or `body` tags.

If your addon is simple enough that one line is sufficient description, then just set the `Header` field in your addon.meta
file and do not include an external description. For short descriptions it is possible to have them internal to the
addon.meta file, but only do this if your description is very short (3-4 lines).

If you refer to another addon make sure you link it. For markdown documents simply use the addon auto-link syntax, for
HTML you will have to construct the proper URL yourself. Keep in mind that many of the web UI pages contain code that
"transforms" simple links by adding extra query parameters to them. For this reason you need to be careful not to include
the queries manually when using HTML descriptions and links to addon information pages and documentation pages.

Your addon description file should contain everything your average user will want to know about your addon. Addons that
are part of a larger pack should generally have a detailed description for the core addon, the child addons then get
shorter descriptions that describe only the features activated by that child addon. Sometimes it is a good idea to put
a link to the core addon in child descriptions as a place to read for more information, but don't do this unless the core
addon description actually has helpful information related to the subject being described.

If your addon is a library that adds templates or script functions you should list these in the addon documentation. Most
of the time you should follow the same format as the standard template and script documentation.

By convention the file containing your addon description should be named `addon.md` (or `addon.html` for HTML format
descriptions). The reason for this is explained later in this section.

Addons should also contain a change log. This file should contain a list of versions and the changes made in each,
as well as a special section listing the differences between your addon and the non-Rubble version (if you provide
one). For consistency change logs should be named `addon_changes.md` (or `addon_changes.html` for HTML format).
It certainly wouldn't hurt anything to link your change log to your addon description. This is done with a simple
doc link like the following:

	[Change Log](/doc/addon_changes.md?addon=Some/Addon)

In general an addon pack only needs one change log, contained in the core addon. You should keep the change log separate
from the addon description so as not to clutter the description with unnecessary information. Change logs are generally
of only minor interest to most users, so it is better to keep them available, but out of the way.

By naming your description file and change log according to these conventions they will both sort together with your
addon.meta file, which makes them easier to find in a long list of files.


File Naming Conventions
------------------------------------------------------------------------------------------------------------------------

The Rubble file naming convention is simple:

	<prefix>_<sequence>_<mod ID>_<child addon suffix>_<core file name>.<extension>

Lets go over each part one at a time shall we?

The "prefix" part is generally forced by DF. Any raw files need to start with a certain string based on what type of raw
file they are. For non-raw files the prefix should be left off.

The "sequence" is a short string used to force a file to sort in a specific order. Most files will not have a sequence
string, but if you need a certain file to be processed before or after another file you can set the sequence. By convention
most sequence strings are `aaa` or `zzz` (process first, and process last respectively), but other sequence strings are
used as well. There is no real reason to have sequence strings longer than three characters (actually there is no reason
to use even three, one will do in most cases).

The "mod ID" is the short identifier you chose for your mod. This should be mostly or all uppercase to make it stand out
from the other parts of the file name. This field makes it easy to see what addon or addon pack a file came from, useful
for those who like to examine the output (or those trying to debug an addon).

The "child addon suffix" is used to differentiate files from child addons in an addon pack. This is conventionally only
included in files that are part of a child addon or for files in addons that share a mod ID. Sometimes an addon pack
core addon will include this field in its files too, sometimes not. Either way is OK, which way to use is based on the
personal preference of the addon author. Conventionally this suffix is related to the addon name, but really anything
that is clear and understandable will do.

The "core file name" is a string differentiating the file from the others like it in the same addon. This is generally
required, and should be all lowercase with spaces replaced by underscores. Sometimes it is possible to leave this off if
there is only one file of a particular type in an addon.

Finally the "extension" is used by Rubble to decide how to handle the file. It is very important to get this part right!
Many files use "two part extensions" with a "first part extension", a dot, and the "last part extension". Rubble Basics
has a large section of file tags and extensions, read that for details. Keep in mind that extensions *must* be lower case!
There is no *should* about this, uppercase extensions will not work (Rubble doesn't like them).

If you look at the default addons you may notice that almost none of them follow this convention. This is because these
addons follow the old convention where the entire addon name was duplicated in the file name. This proved to be too
verbose, so the convention was changed to it's present form.

Examples:

* `FL_libs_random_bodies.mod.lua`: A file containing functions for generating random bodies contained in `First Landing/Libs/Random/Bodies`.
* `creature_FL_fauna_default_vermin.txt`: A creature file for the addon `First Landing/Fauna/Default Vermin`.
* `building_b_FL_base_sawmill.txt`: The raw file containing the sawmill building in `First Landing/Base`.
* `FL_libs_bp_head.mod.lua`: Head body part prefab definitions for `First Landing/Libs/Body Parts`

The most important rule is that it should be fairly easy to follow the file name to the containing addon. It does not
need to be possible to determine the addon name from the file name without access to a list of valid addons, but it
should be easy to determine which of a list of addons a file belongs to at a glance.

No file of any kind should have version numbers (or anything similar) in the name. It is a particularly bad idea to add
version numbers to any kind of documentation such as change logs or addon description files, as doing so will require
you to remember to update all your links in other documentation files and/or the references in addon.meta.

The order of the various elements is chosen so that, in general, files of a given type from a given addon will sort
together, making it easier to find what you are looking for. Also the order of fields in the file name parallels the
order of elements in an addon name, which makes it easier to identify the originating addon.


Template and Variable Naming Conventions
------------------------------------------------------------------------------------------------------------------------

Similar to files your addon's templates and configuration variables should be named consistently. Template and variable
naming conventions are simpler than files:

	<mod ID>_<name>

Once again, section by section:

The "mod ID" is, once again, the short identifier you chose for your addon or addon pack.

Finally the "name" is a simple descriptive name for your template or variable. Try not to choose names that are "excessively
generic", but this is not a big deal (keeping generic names from clashing is what the mod ID is for).

If you need temporary variables for use with templates such as `@PARSE_TO` it is best to use the variable `TEMP` or, if
that is not possible (you need more than one temporary for example), numeric variables starting from 0 (`$0`, `$1`, etc).
New variables that will be created, used once, and then immediately discarded are frowned upon, since configuration
variables are global and persistent (for the lifetime of the Rubble state). The vast majority of template code only needs
one temporary variable (if that), so don't clutter the state unnecessarily.


Script Registry Key Naming Conventions
------------------------------------------------------------------------------------------------------------------------

Script registry keys should use the following format:

	<addon name>:<template name>:<extra>

"addon name" is the name of the addon that the key belongs to, simple.

If applicable "template name" should be the full name of the primary template that uses the key. If one template writes
data to a key and another reads the data back use the name of the writing template. If multiple templates write to the
key use the name of the one used most commonly. If the primary interface to the key is a script function rather than a
template use the function name.

The "extra" field is set if a template needs multiple keys, in this case set this field to something descriptive.
